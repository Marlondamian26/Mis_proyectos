@startuml
' Componentes principales de la aplicación Phase Platform

package "API REST (NestJS)" {
  [AppController]
  [AuthModule]
  [ConductoresModule]
  [TarjetasModule]
  [TarifasModule]
  [PagosModule]
  [FacturasModule]
  [AuditoriaModule]
  [Common (pipes, guards, filters, interceptors)]
  [CacheModule]
}

[AppController] --> [AuthModule]
[AppController] --> [ConductoresModule]
[AppController] --> [TarjetasModule]
[AppController] --> [TarifasModule]
[AppController] --> [PagosModule]
[AppController] --> [FacturasModule]
[AppController] --> [AuditoriaModule]

[AuthModule] ..> [Common (pipes, guards, filters, interceptors)]
[ConductoresModule] ..> [Common (pipes, guards, filters, interceptors)]
[TarjetasModule] ..> [Common (pipes, guards, filters, interceptors)]
[TarifasModule] ..> [Common (pipes, guards, filters, interceptors)]
[PagosModule] ..> [Common (pipes, guards, filters, interceptors)]
[FacturasModule] ..> [Common (pipes, guards, filters, interceptors)]
[AuditoriaModule] ..> [Common (pipes, guards, filters, interceptors)]

[CacheModule] ..> [Common (pipes, guards, filters, interceptors)]

' Dependencias externas
database "PostgreSQL\nphase_platform" as PostgreSQL
[AuthModule] --> PostgreSQL
[ConductoresModule] --> PostgreSQL
[TarjetasModule] --> PostgreSQL
[TarifasModule] --> PostgreSQL
[PagosModule] --> PostgreSQL
[FacturasModule] --> PostgreSQL
[AuditoriaModule] --> PostgreSQL

' Generación de PDF local
[FacturasModule] ..> [pdfkit] : "Generación de PDF local"

' Monitoreo opcional
[PrometheusModule] as Prometheus
[AppController] ..> Prometheus : "Métricas (opcional)"

' Cliente externo (Frontend, Postman, etc.)
actor "Cliente API" as Client
Client --> [AppController] : "HTTP/HTTPS"

@enduml