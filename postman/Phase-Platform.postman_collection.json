{
	"info": {
		"_postman_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
		"name": "Phase Platform API",
		"description": "Colección de endpoints para la plataforma Phase",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Auth",
			"item": [
				{
					"name": "Login",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log('Current token:', pm.environment.get('accessToken'));",
									"console.log('Current role:', pm.environment.get('userRole'));",
									"console.log('Current user ID:', pm.environment.get('userId'));",
									"",
									"const response = pm.response.json();",
									"console.log('Login response:', response);",
									"",
									"pm.test('Response time is less than 3s', function () {",
									"    pm.expect(pm.response.responseTime).to.be.below(3000);",
									"});",
									"",
									"if (pm.response.code === 201 || pm.response.code === 200) {",
									"    pm.test('Response has access token', function () {",
									"        pm.expect(response.accessToken).to.exist;",
									"        pm.environment.set('accessToken', response.accessToken);",
									"    });",
									"",
									"    pm.test('Response has refresh token', function () {",
									"        pm.expect(response.refreshToken).to.exist;",
									"        pm.environment.set('refreshToken', response.refreshToken);",
									"    });",
									"",
									"    pm.test('Response has user info', function () {",
									"        pm.expect(response.user).to.exist;",
									"        pm.expect(response.user.id).to.exist;",
									"        pm.expect(response.user.role).to.exist;",
									"        pm.environment.set('userId', response.user.id);",
									"        pm.environment.set('userRole', response.user.role);",
									"    });",
									"} else {",
									"    pm.test('Error response is valid', function () {",
									"        pm.expect(response.statusCode || response.error).to.exist;",
									"        pm.expect(response.message).to.exist;",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"{{testEmail}}\",\n    \"password\": \"{{testPassword}}\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/auth/login",
							"host": ["{{baseUrl}}"],
							"path": ["auth", "login"]
						},
						"description": "Iniciar sesión en la plataforma"
					}
				},
				{
					"name": "Register",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const response = pm.response.json();",
									"",
									"pm.test('Response time is less than 3s', function () {",
									"    pm.expect(pm.response.responseTime).to.be.below(3000);",
									"});",
									"",
									"if (pm.response.code === 201) {",
									"    pm.test('User created successfully', function () {",
									"        pm.expect(response.message).to.exist;",
									"        pm.expect(response.user).to.exist;",
									"    });",
									"} else {",
									"    pm.test('Error response is valid', function () {",
									"        pm.expect(response.statusCode || response.error).to.exist;",
									"        pm.expect(response.message).to.exist;",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"new@example.com\",\n    \"password\": \"password123\",\n    \"nombre\": \"New User\",\n    \"telefono\": \"1234567890\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/auth/register",
							"host": ["{{baseUrl}}"],
							"path": ["auth", "register"]
						},
						"description": "Registrar un nuevo conductor"
					}
				},
				{
					"name": "Refresh Token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log('Current token:', pm.environment.get('accessToken'));",
									"console.log('Current role:', pm.environment.get('userRole'));",
									"console.log('Current user ID:', pm.environment.get('userId'));",
									"console.log('Current refresh token:', pm.environment.get('refreshToken'));",
									"",
									"const response = pm.response.json();",
									"console.log('Refresh response:', response);",
									"",
									"pm.test('Response time is less than 3s', function () {",
									"    pm.expect(pm.response.responseTime).to.be.below(3000);",
									"});",
									"",
									"if (pm.response.code === 200) {",
									"    pm.test('New access token received', function () {",
									"        pm.expect(response.accessToken).to.exist;",
									"        pm.environment.set('accessToken', response.accessToken);",
									"    });",
									"",
									"    pm.test('New refresh token received', function () {",
									"        pm.expect(response.refreshToken).to.exist;",
									"        pm.environment.set('refreshToken', response.refreshToken);",
									"    });",
									"} else {",
									"    pm.test('Error response is valid', function () {",
									"        pm.expect(response.statusCode || response.error).to.exist;",
									"        pm.expect(response.message).to.exist;",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"refreshToken\": \"{{refreshToken}}\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/auth/refresh",
							"host": ["{{baseUrl}}"],
							"path": ["auth", "refresh"]
						},
						"description": "Renovar el token de acceso"
					}
				}
			]
		},
		{
			"name": "Conductores",
			"item": [
				{
					"name": "Get All Conductores",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/conductores?page=1&limit=10",
							"host": ["{{baseUrl}}"],
							"path": ["conductores"],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "limit",
									"value": "10"
								}
							]
						},
						"description": "Obtener lista de conductores"
					}
				},
				{
					"name": "Get Conductor by ID",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/conductores/1",
							"host": ["{{baseUrl}}"],
							"path": ["conductores", "1"]
						},
						"description": "Obtener detalles de un conductor específico"
					}
				},
				{
					"name": "Update Conductor",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"nombre\": \"Updated Name\",\n    \"telefono\": \"9876543210\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/conductores/1",
							"host": ["{{baseUrl}}"],
							"path": ["conductores", "1"]
						},
						"description": "Actualizar información de un conductor"
					}
				},
				{
					"name": "Delete Conductor",
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/conductores/1",
							"host": ["{{baseUrl}}"],
							"path": ["conductores", "1"]
						},
						"description": "Eliminar un conductor"
					}
				}
			]
		},
		{
			"name": "Pagos",
			"item": [
				{
					"name": "Get All Pagos",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/pagos?page=1&limit=10",
							"host": ["{{baseUrl}}"],
							"path": ["pagos"],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "limit",
									"value": "10"
								}
							]
						},
						"description": "Obtener lista de pagos"
					}
				},
				{
					"name": "Get Pago by ID",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/pagos/1",
							"host": ["{{baseUrl}}"],
							"path": ["pagos", "1"]
						},
						"description": "Obtener detalles de un pago específico"
					}
				},
				{
					"name": "Create Pago",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"conductorId\": \"1\",\n    \"monto\": 100.50,\n    \"fecha\": \"2024-03-20\",\n    \"descripcion\": \"Pago por servicios\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/pagos",
							"host": ["{{baseUrl}}"],
							"path": ["pagos"]
						},
						"description": "Crear un nuevo pago"
					}
				},
				{
					"name": "Update Pago",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"monto\": 150.75,\n    \"descripcion\": \"Pago actualizado\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/pagos/1",
							"host": ["{{baseUrl}}"],
							"path": ["pagos", "1"]
						},
						"description": "Actualizar un pago existente"
					}
				},
				{
					"name": "Delete Pago",
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/pagos/1",
							"host": ["{{baseUrl}}"],
							"path": ["pagos", "1"]
						},
						"description": "Eliminar un pago"
					}
				}
			]
		},
		{
			"name": "Facturas",
			"item": [
				{
					"name": "Get All Facturas",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/facturas?page=1&limit=10",
							"host": ["{{baseUrl}}"],
							"path": ["facturas"],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "limit",
									"value": "10"
								}
							]
						},
						"description": "Obtener lista de facturas"
					}
				},
				{
					"name": "Get Factura by ID",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/facturas/1",
							"host": ["{{baseUrl}}"],
							"path": ["facturas", "1"]
						},
						"description": "Obtener detalles de una factura específica"
					}
				},
				{
					"name": "Create Factura",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"conductorId\": \"1\",\n    \"monto\": 1500.00,\n    \"fechaEmision\": \"2024-03-20\",\n    \"fechaVencimiento\": \"2024-04-20\",\n    \"descripcion\": \"Factura por servicios de marzo\",\n    \"estado\": \"PENDIENTE\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/facturas",
							"host": ["{{baseUrl}}"],
							"path": ["facturas"]
						},
						"description": "Crear una nueva factura"
					}
				},
				{
					"name": "Update Factura",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"estado\": \"PAGADA\",\n    \"fechaPago\": \"2024-03-21\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/facturas/1",
							"host": ["{{baseUrl}}"],
							"path": ["facturas", "1"]
						},
						"description": "Actualizar una factura existente"
					}
				}
			]
		},
		{
			"name": "Tarifas",
			"item": [
				{
					"name": "Get All Tarifas",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/tarifas?page=1&limit=10",
							"host": ["{{baseUrl}}"],
							"path": ["tarifas"],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "limit",
									"value": "10"
								}
							]
						},
						"description": "Obtener lista de tarifas"
					}
				},
				{
					"name": "Get Tarifa by ID",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/tarifas/1",
							"host": ["{{baseUrl}}"],
							"path": ["tarifas", "1"]
						},
						"description": "Obtener detalles de una tarifa específica"
					}
				},
				{
					"name": "Create Tarifa",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"nombre\": \"Tarifa Básica\",\n    \"descripcion\": \"Tarifa estándar para conductores\",\n    \"monto\": 500.00,\n    \"periodo\": \"MENSUAL\",\n    \"estado\": \"ACTIVA\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/tarifas",
							"host": ["{{baseUrl}}"],
							"path": ["tarifas"]
						},
						"description": "Crear una nueva tarifa"
					}
				},
				{
					"name": "Update Tarifa",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"monto\": 550.00,\n    \"estado\": \"INACTIVA\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/tarifas/1",
							"host": ["{{baseUrl}}"],
							"path": ["tarifas", "1"]
						},
						"description": "Actualizar una tarifa existente"
					}
				}
			]
		},
		{
			"name": "Tarjetas",
			"item": [
				{
					"name": "Get All Tarjetas",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/tarjetas?page=1&limit=10",
							"host": ["{{baseUrl}}"],
							"path": ["tarjetas"],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "limit",
									"value": "10"
								}
							]
						},
						"description": "Obtener lista de tarjetas"
					}
				},
				{
					"name": "Get Tarjeta by ID",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/tarjetas/1",
							"host": ["{{baseUrl}}"],
							"path": ["tarjetas", "1"]
						},
						"description": "Obtener detalles de una tarjeta específica"
					}
				},
				{
					"name": "Create Tarjeta",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"conductorId\": \"1\",\n    \"numero\": \"4111111111111111\",\n    \"nombreTitular\": \"John Doe\",\n    \"fechaVencimiento\": \"12/25\",\n    \"cvv\": \"123\",\n    \"tipo\": \"VISA\",\n    \"estado\": \"ACTIVA\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/tarjetas",
							"host": ["{{baseUrl}}"],
							"path": ["tarjetas"]
						},
						"description": "Registrar una nueva tarjeta"
					}
				},
				{
					"name": "Update Tarjeta",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"estado\": \"INACTIVA\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/tarjetas/1",
							"host": ["{{baseUrl}}"],
							"path": ["tarjetas", "1"]
						},
						"description": "Actualizar una tarjeta existente"
					}
				},
				{
					"name": "Delete Tarjeta",
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/tarjetas/1",
							"host": ["{{baseUrl}}"],
							"path": ["tarjetas", "1"]
						},
						"description": "Eliminar una tarjeta"
					}
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Verificar si hay token antes de cada petición",
					"if (!pm.environment.get('accessToken')) {",
					"    console.log('No token found in environment');",
					"}"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Script global de pruebas",
					"pm.test('Response time is less than 3s', function () {",
					"    pm.expect(pm.response.responseTime).to.be.below(3000);",
					"});"
				]
			}
		}
	],
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:3000",
			"type": "string"
		},
		{
			"key": "accessToken",
			"value": "",
			"type": "string"
		},
		{
			"key": "refreshToken",
			"value": "",
			"type": "string"
		}
	]
} 